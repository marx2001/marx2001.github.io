---
layout: post
title: "tb2j新版测试+wannier3.1.0"
subtitle: "Literature Sharing (Adv. Mater. 2025, 37, 2305044)"
background: '/img/bg-sci-note.jpg'
categories: sci-note
permalink: /sci-note_posts/20251127-tb2j
---


# <center>Recording​</center>

先跑一遍流程，看看是否有报错。

拟合完的指令：wannier90.x wannier90 &

进入pyw90环境：conda activate pyw90_env
pyw90 eig suggest --path . -e -20 20 -w 20 在选定能量区间内计算推荐的内外能量窗口的范围

激活TB2J：source /public/home/cssong/song/zhchen/1_materials/1_VTeCl/TB2J/strain/-2/TB2J_env/bin/activate
求磁耦合参数：wann2J.py --spinor --groupby spin --efermi -1.0098 --emin -2.06514 --emax -0.065 --elements Nb --kmesh 9 9 1 --nz 100 --rcut 6.0 --np 1 
求平均值：TB2J_merge.py  --type structure x y z


### 1. 查看tb2j版本
```shell
pip show TB2J
```

新0.7.2.1版本的tb2j安装：

创建环境
```shell
conda create -n tb2j_env python=3.10 -y
```


进入环境：
```shell
conda activate tb2j_env
```

现升级为tb2j0.9.0版本。

0.7.1.1版本的环境进入方法：
```shell
source /public/home/cssong/song/zhchen/1_materials/1_VTeCl/TB2J/strain/-2/TB2J_env/bin/activate
```


### 2. 运行

```shell

wann2J.py --spinor --groupby spin --efermi -1.071192 --emin -6.39197 --emax 4.94 --elements Nb --kmesh 7 7 1 --nz 100 --rcut 6.6 --np 1

```

自行修改合适的区间

### 3. 如果配体的自旋磁动量不可忽略，需要downfolding海森堡哈密顿量

先：
```shell

wann2J.py --elements Cr I ....

```

结果保存到TB2J_results目录后，运行downfolding功能，得到仅有Cr有效交换参数：

```shell

TB2J_downfold.py --inpath TB2J_results --outpath TB2J_results_downfold --metals Cr --ligands I

```

文件夹中的文件要有POSCAR、POTCAR、xyz、hr.dat或tb.dat（某些版本的tb2j可以识别，见官方文档）、win文件等等，主要是dat文件，都放上也没坏处。


# <center>Results</center>

上一模块是简要的过程记录，下面是结果比对，包括新老版本的

首先用0.7.1.1的版本进行测试：

进入环境：
```shell

source /public/home/cssong/song/zhchen/1_materials/1_VTeCl/TB2J/strain/-2/TB2J_env/bin/activate

```

运行命令：

```shell

wann2J.py --spinor --groupby spin --efermi -1.065140 --emin -3 --emax 1 --elements Nb --kmesh 7 7 1 --nz 100 --rcut 6 --np 1

```
得到结果

其它命令：

求平均值：

```shell

TB2J_merge.py  --type structure x y z 

```
求磁耦合参数：
```shell

wann2J.py --spinor --groupby spin --efermi -1.0098 --emin -2.06514 --emax -0.065 --elements Nb --kmesh 9 9 1 --nz 100 --rcut 6.0 --np 1

```

得到结果如下，体系为交错磁，而计算结果显示z方向磁矩为铁磁，我认为紧束缚模型可能有问题，需要重新拟合。升级了wannier90版本之后，也有许多新问题出现，比如一样的能量窗口，拟合
结果也对的上，但是k点由5*5*1变为22*22*11之后出现表面态等结果不对等问题，而且k点到超过13*13*1之后，会出现开发者才能遇到的问题（报错中的信息是这么写的），报错内容是k点矢量方向变化，按照chatgpt5.1的建议修改为偶数个k点后，可以正常计算。

<img src="/img/tb2j新版测试/bg-t1.png" style="width:100%; margin-bottom:5px;">

第一次测试结束。