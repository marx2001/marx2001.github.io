---
layout: post
title: "vasp计算DMI大小"
subtitle: "Experience Sharing"
background: '/img/bg-sci-note.jpg'
categories: sci-note
permalink: /sci-note_posts/20250925-D
---

# <center>Vasp计算DMI</center>

为了研究二维材料的拓扑自旋纹理，我们需要计算海森堡模型中的DMI的能量大小。

DMI的大小取决于两个核心条件——对称性和自旋轨道耦合。只有存在较强的自旋轨道耦合（SOC），才有可能产生DMI。这是因为DMI本质上来源于SOC对超交换相互作用的修正。

在轻元素体系里，SOC很弱，DMI可以忽略。

含有重元素（如过渡金属、5d元素、Bi，W，Ir等）或者与重原子基地相耦合的二维材料，更容易产生显著的DMI。

根据Moriya定理，缺乏空间反演对称性，如果两个磁性原子之间的中点存在反演中心，对应的DMI为0.因此在二位材料中产生DMI，需要在结构上产生破缺的对称性。

例如：固有结构的不对称、缺陷或表面不对称；界面或基底效应；外场诱导（电场或者应变导致结构对称性破缺）

点群限制：DMI的方向由晶体对称性决定。二维材料中，常见的 C₃v、C₂v 等对称性都可能允许 DM 相互作用。


**<span style="font-size: 120%"> 1. 能量法的计算步骤</span>**

以MPSS为例，其结构如图所示

<div align="center"><img src="/img/vasp计算能带/bg-s1.png" alt="MPSS结构图" style="width:500px; height:auto;"/></div>
<div align="center"><img src="/img/vasp计算能带/bg-s2.png" alt="MPSS结构图" style="width:500px; height:auto;"/></div>

首先准备INCAR

```python
SYSTEM = MPSS
LREAL= Auto
ALGO= Normal

ISTART = 0
ICHARG = 2

ENCUT = 520
NCORE= 4
NPAR=4

ISMEAR = 0 
SIGMA = 0.05
GGA=PE

ISPIN=2
MAGMOM = 12*0.0  -4 0 0 0 0 -4 4 0 0 0 0 4 96*0.0

LDAU = .TRUE.
LDAUTYPE = 2
LDAUL = 2 2 -1 -1
LDAUU = 0.5 2.0 0.0 0.0
LDAUJ = 0.0 0.0 0.0 0.0
LDAUPRINT = 2

LSORBIT=.TRUE.
LORBMOM=.TRUE.

NELM =200
LORBIT=11
VOSKOWN = 1
ISYM = 0
GGA_COMPAT = .FALSE.
LWAVE=.F
LCHARG=.F
EDIFF = 1E-6 
EDIFFG = -0.01

LMAXMIX=4

```
需要注意的是，能量法的原理是设置磁态为顺时针的能量减去逆时针的能量再除以一个系数，所以我们需要在ISPIN=2的情况下，设置磁矩为顺时针的方向。

由于是磁性体系，所以要增加很多设置，虽然部分设置是隐式开启或者关闭的，但根据官网的说法，显式地设置出来，也会起到一定的作用。

注意，个人习惯先用AGLO=Fast,这样计算速度快，可以快速了解大概的情况，同时第一次计算的时候，可以取小K点，同样使得计算速度快。单层材料不加IVDW范德华修正。
个人习惯开启自旋极化后不设置磁矩，让其自行演化，得到最准确的基态。

对于强关联体系，必须加U，具体数值自行测试。

由于要设置顺时针四个方向的磁矩，只有一个磁性原子显然是不够的，所以我们需要在x方向扩4倍于原胞大小的超胞，在shell面板内，输入vaspkt/401/4 1 1，注意411之间要加空格。

得到SUPERCELL411.vasp文件后，修改名称为POSCAR。

接下来准备KPOINTS，有一个细节，不要使用之前计算的KPOINTS，而是要再次键入vaspkit/102/1/102/0.03，得到KPOINTS。

准备好POSCAR、POTCAR、KPOINTS后，提交任务进行计算。任务脚本如下：

```shell

#!/bin/bash 
#PBS -l nodes=1:ppn=64
#PBS -l walltime=640:01:00 
#PBS -j oe
#PBS -q sugon
#PBS -N D_MP

cd $PBS_O_WORKDIR

echo job id is $PBS_JOBID | tee  pbslog
echo run nodes is following: | tee -a pbslog
cat $PBS_NODEFILE | tee  -a pbslog

echo begin time is `date` | tee -a  pbslog
id=`echo $PBS_JOBID|awk -F. '{print $1}' `
NP=`cat $PBS_NODEFILE|wc -l`


source /public/software/profile.d/compiler_intel-compiler-2021.3.0.sh 
source  /public/software/profile.d/mpi_intelmpi-2021.3.0.sh 
RUN_1=/public/home/cssong/app/vasp/intel_2021.3.0/5.4.4/vasp_std
RUN_2=/public/home/cssong/app/vasp/intel_2021.3.0/5.4.4/vasp_ncl
cat $PBS_NODEFILE | uniq -c | awk '{ printf("%s:%s\n", $2, $1); }' >> $PBS_JOBID-$PBS_JOBCOOKIE.hosts


for i in {cw,acw}
do
mkdir $i
cd $i
cp ../incar.$i ./INCAR
cp ../POTCAR .
cp ../KPOINTS .
cp ../POSCAR .
mpirun  -np $NP  ${RUN_2}>&log
rm CHG  
rm WAVECAR

cd ..
done



```

等待计算结束后，键入qvasp -e，收集能量信息，cw的能量减去acw的能量除以一个系数即可。这个系数根据体系而定，可以参考具体的文献。


**<span style="font-size: 120%"> 1. 四态法的计算步骤</span>**

四态法是指通过构建四种磁态，通过求解这四个海森堡模型哈密顿方程的方程组来得到对应的磁耦合参数，具有一般性，但计算量相比于能量法较大，对于原胞内原子数目较多的大体系而言，设备要求较高。

应用四态法计算DMI，首先要构建超胞，以MPSS的三角晶格为例，由于两个磁性原子之间的距离为0.637nm，所以我们选择扩3*3*1的超胞，使得相邻周期同一原子的距离大于0.15nm，以屏蔽相邻周期同一磁性原子的影响。

然后构建四个磁态，这四个磁态分别是均是朝上的铁磁，一上一下反铁磁+其它磁性原子向上、一下以上+其他磁性原子向上、同下+其他磁性原子向上。运行计算任务后，E1+E4-E2-E3的结果再除以4即可，为了得到真实的能量，需要再除以自旋的平方，自旋量子数的数值是原胞磁矩的值除以2.

提交计算任务的脚本为：

```shell

#!/bin/bash 
#PBS -l nodes=1:ppn=64
#PBS -l walltime=640:01:00 
#PBS -j oe
#PBS -q sugon
#PBS -N ST_D

cd $PBS_O_WORKDIR

echo job id is $PBS_JOBID | tee  pbslog
echo run nodes is following: | tee -a pbslog
cat $PBS_NODEFILE | tee  -a pbslog

echo begin time is `date` | tee -a  pbslog
id=`echo $PBS_JOBID|awk -F. '{print $1}' `
NP=`cat $PBS_NODEFILE|wc -l`


source /public/software/profile.d/compiler_intel-compiler-2021.3.0.sh 
source  /public/software/profile.d/mpi_intelmpi-2021.3.0.sh 
RUN_1=/public/home/cssong/app/vasp/intel_2021.3.0/5.4.4/vasp_std
RUN_2=/public/home/cssong/app/vasp/intel_2021.3.0/5.4.4/vasp_ncl
cat $PBS_NODEFILE | uniq -c | awk '{ printf("%s:%s\n", $2, $1); }' >> $PBS_JOBID-$PBS_JOBCOOKIE.hosts


for i in {x,y,z}	
do	
cd D$i

	for k in {1,2,3,4}
	do
	mkdir $k
	cd $k
	cp ../POSCAR .
	cp ../POTCAR .
	cp ../KPOINTS .
	cp ../INCAR$k ./INCAR

	cd ..
	done

	cd ..
	done


rm -rf $PBS_JOBID-$PBS_JOBCOOKIE.hosts


```