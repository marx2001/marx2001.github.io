---
layout: post
title: "wannier90的能带拟合步骤"
subtitle: "Experience Sharing"
background: '/img/bg-sci-note.jpg'
categories: sci-note
permalink: /sci-note_posts/20251127-band
---

# <center>流程与步骤日志​</center>

### 1. static计算

不开启ncl

k点取11，如下
```shell
K-Spacing Value to Generate K-Mesh: 0.030
0
Gamma
11   11   1
0.0  0.0  0.0
```
INCAR如下
```shell

SYSTEM = MOPTSNS
LREAL= Auto
ALGO= Normal
#ISEARCH=1
PREC=High

ISTART = 0
ICHARG = 2

ENCUT = 520
NCORE= 4
ISYM=2

ISMEAR =0
SIGMA = 0.04

NSW = 0
ISIF = 2
IBRION =-1
LWAVE=.T
LCHARG=.T
EDIFF = 1E-6
EDIFFG = -0.01

NELM=100

LDAU=.T
LDAUTYPE=2
LDAUL=2 -1 -1 -1           #库伦排斥的轨道，对应元素
LDAUU=1.5 0.0 0.0 0.0   #几个元素几个数
LDAUJ=0.0 0.0 0.0 0.0   #stoner交换参数大小
LDAUPRINT = 2

ISPIN=2
MAGMOM = 0 0 4 0 0 -4 9*0
LMAXMIX=4

LSORBIT=.T

AMIX     = 0.1
BMIX     = 0.0001 
AMIX_MAG = 0.8
BMIX_MAG = 0.0001

```

运行计算


获得结果并查看磁矩

```shell

magnetization (x)

# of ion       s       p       d       tot
------------------------------------------
    1        0.014   0.006   0.663   0.682
    2       -0.014  -0.006  -0.663  -0.682
    3        0.000   0.000   0.000   0.000
    4        0.000   0.000   0.000   0.000
    5        0.000   0.000   0.000   0.000
--------------------------------------------------
tot          0.000   0.000   0.000   0.000

```

### 2. bandsoc计算
INCAR如下
```shell

SYSTEM = MOPTSNS
LREAL= Auto
ALGO= Normal
#ISEARCH=1
PREC=High

ISTART = 1
ICHARG = 11 #=11用于电子能带和态密度计算，此过程中电荷密度不变

ENCUT =520
NCORE= 4

ISMEAR = 0 
SIGMA = 0.04
GGA=PE

LSORBIT=.TRUE.
LORBMOM=.TRUE.

LWAVE=.F; 
LCHARG=.F
EDIFF = 1E-6
EDIFFG = -0.01
ISYM = 0

NBANDS=64
LDAU=.T
LDAUTYPE=2
LDAUL=2 -1 -1 -1            #库伦排斥的轨道，对应元素
LDAUU=1.5 0.0 0.0 0.0      #几个元素几个数
LDAUJ=0.0 0.0 0.0 0.0       #stoner交换参数大小
LDAUPRINT = 2
LORBIT=11         #常用=11，输出包含IM投影的PROCAR和DOSCAR

ISPIN=2
MAGMOM = 0 0 4 0 0 -4  9*0
LMAXMIX=4

AMIX     = 0.01
BMIX     = 0.0001 
AMIX_MAG = 0.8
BMIX_MAG = 0.0001

```
kpoints如下
```shell

K-Path Generated by VASPKIT.
   20
Line-Mode
Reciprocal
   0.0000000000   0.0000000000   0.0000000000     GAMMA
   0.5000000000   0.0000000000   0.0000000000     X  

   0.5000000000   0.0000000000   0.0000000000     X  
   0.5000000000   0.5000000000   0.0000000000     M 
  
   0.5000000000   0.5000000000   0.0000000000     M 
   0.0000000000   0.5000000000   0.0000000000     Y

   0.0000000000   0.5000000000   0.0000000000     Y
   0.0000000000   0.0000000000   0.0000000000     GAMMA

```

绘制投影能带(略)

### 3. ncl_Wannier90计算

添加LWANNIER90=.T


以及WANNIER_WIN和NBANDS=64以及NUM_WANN=38的tag，其它的参数参考ncl的设置方式进行修改

NCORE=4注释掉

```shell

SYSTEM = MOPTSNS
LREAL= .F
ALGO= Normal
#ISEARCH=1
PREC=High

ISTART = 0
ICHARG = 2

ENCUT = 520
NCORE= 4
ISYM=2

ISMEAR =0
SIGMA = 0.04

NSW = 0
ISIF = 2
IBRION =-1
LWAVE=.F
LCHARG=.T
EDIFF = 1E-6
EDIFFG = -0.01

NELM=100

LDAU=.T
LDAUTYPE=2
LDAUL=2 -1 -1 -1           #库伦排斥的轨道，对应元素
LDAUU=1.5 0.0 0.0 0.0   #几个元素几个数
LDAUJ=0.0 0.0 0.0 0.0   #stoner交换参数大小
LDAUPRINT = 2

ISPIN=2
MAGMOM = 0 0 4 0 0 -4 9*0
LMAXMIX=4

LSORBIT=.T
LORBMOM=.TRUE.
LORBIT=11

LWANNIER90=.T
NBANDS=64
NUM_WANN=38

WANNIER90_WIN="
kmesh_tol=0.00001
num_wann=38
"

AMIX     = 0.1
BMIX     = 0.0001 
AMIX_MAG = 0.8
BMIX_MAG = 0.0001

```


体系不易收敛，可以尝试开启输出波函数和电荷密度方便续算.

### 4. 能带拟合

后续过程见之前的Bi烯教程中的相应部分的内容


# <center>Results</center>

```shell

```shell

 # z2 number for 6 planes
 k1=0.0, k2-k3 plane:            0
 k1=0.5, k2-k3 plane:            0
 k2=0.0, k1-k3 plane:            0
 k2=0.5, k1-k3 plane:            0
 k3=0.0, k1-k2 plane:            1
 k3=0.5, k1-k2 plane:            1
 Time cost for Z2_calc is about           24.755 s
```

结果不太对，判断为构建紧束缚模型的时候可能考虑了多余的轨道，导致既有陈数又有Z2.

如果static是线性计算的，看看是否会有影响。（因为之前用的线性计算的static的chgcar，并未出现陈数和z2数同时出现的情况）

问题同样出现，应该是拟合轨道数目的问题，新版本wannier可能对轨道的严格性做了提升，1.2的版本可以正常计算出Z2拓扑不变量。

# <center>选择合适的轨道的结果​</center>

遇到一个情况，启动第三步，静态ncl+LWANNIER90=.T的时候，一定要先清理上次计算剩下的输出文件mmn等，并删掉win文件中上次计算vasp生成的部分，然后重新启动计算，这样能保证输出正
确，减少遇到非主流报错的可能性。