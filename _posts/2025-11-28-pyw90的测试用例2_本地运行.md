---
layout: post
title: "pyw90的测试用例2_本地运行"
subtitle: "Experience Sharing"
background: '/img/bg-sci-note.jpg'
categories: sci-note
permalink: /sci-note_posts/20251128-pyw-auto
---

https://github.com/Cloudiiink/pyw90/blob/master/README.md

首先以任意窗口成功地运行一次weannier90，得到wannier90_band.dat文件。准备好auto_w90_input.yaml文件。

修改auto_w90_input.yaml文件中的代码为：

```shell

# File location
#runfile: w90.script
vasp_band_file: bnd.dat
seedname: wannier90

# system
jobname: w90
username: xpwu

# run at the local machine not via SLURM
# ! YOU HAVE TO KNOWN WHAT YOU ARE DOING
# 
# If you have any question, please ask the administrator of your server. DO AT YOUR OWN RISK
# If you choose to run locally, you don't need to give `runfile` value
# how to run your job locally. Only used when `local` is `True`.
local: True

# ! IMPORTANT: Make sure you have added `wannier90.x` to your `$PATH` if you want to run as following
# single core
localrun: wannier90.x wannier90
```

然后运行，这个要在band计算的文件夹中运行才能得到正确的bnd.dat，大小应该和BAND.dat文件相差不大

```shell

pyw90 pre band

```

得到vasp计算的bnd.dat文件

再运行
```shell

pyw90 auto run

```

设置窗口的技巧，能量上下限减去费米能级，即为origin作图的能带图的能量范围，可以根据dft计算的能量范围设计每一次迭代的能量上下限。

得到结果后，修改yml文件中的窗口范围，然后改变固定窗口，比如原来固定小窗口，优化大窗口，同时也要修改窗口变化的范围，大概看一眼能带，选择合适的区间

经过一些测试，我发现固定两个窗口的min，优化max窗口的位置似乎是一个不错的开始，因为我们可以在gap处设置好min，可以保证这个min的数值没有问题，然后比较难搞的上窗口通过迭代方式
优化得到。

以上为暂时的最终的程序使用方法和心得体会。

流程梳理：

1. static计算得到CHGCAR

2. bandsoc计算得到bnd.dat

3. wannier90的能带拟合，一定要确定好min窗口所在的能量，记得减去费米能级对照origin画的能带图确定min窗口所在的能量值

4. 运行pyw90进行上窗口能量优化，如果中途计算因为包含的state不足而停掉，那么需要重新修改yaml的窗口和win文件的窗口匹配，检查好yaml内能量窗口的变化的范围。

5. 重复上述步骤3、4，直到能带完全对应。

```shell

pyw90 cmp wannier90 --efermi -0.9931 --kernel gaussian,0,2

```

yaml文件中有kernel的设置，efermi可以自己寻找

备注：如果没有bnd.dat文件，运行指令产生

```shell

pyw90 pre band

```

终止任务

```shell

pyw90 auto term

```

或者

```shell

kill 任务号

```