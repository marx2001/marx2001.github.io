---
layout: post
title: "vasp结构优化"
subtitle: "Scripts made by myself"
background: '/img/bg-sci-note.jpg'
categories: sci-note
permalink: /sci-note_posts/20250926-geo
---

# <center>vasp结构优化步骤</center>

对于磁性材料的结构优化相比于非磁材料来说，复杂程度有所提高。本文区别于全网介绍结构优化的步骤的文章，详细的提供两种进阶的结构优化方式。


1. 第一种结构优化方式

首先进行非磁结构优化，即正常的结构优化（isif=3），确保结构在没有磁相互作用的情况下达到最稳定的状态

再进行静态自洽计算，即，使用优化后的结构，分别对铁磁和反铁磁的磁构型进行静态自洽计算（isif=2，nsw=0,ibrion=-1）

最后比较设置的几种磁构型的能量，最低的那个被认为是基态。

优势：这种方法可以确保所有的磁构型都是在相同结构的基础上比较的，因此能量的比较是很公平的。

适用范围： 磁性对结构影响不大的材料

缺点：如果磁性对结构有显著影响，那么这个方法并不准确。

2. 第二种结构优化的方式

首先设置不同的磁构型，分别进行结构优化（isif=3，nsw=400，ibrion=2）

然后进行能量的比较。

缺点：对每种磁构型单独优化，计算量大

3. 个人选择

对于完全陌生的材料，我个人会选择isif=3，逐步结构优化，设置力和能量的收敛标准为1e-6和-0.01，这个标准已经足够精确，并可以用于其他参数的计算。

然后基于优化结果计算材料的J，因为计算J的时候会设置四种磁构型，所以得到J的数值后，同时也可以得到磁基态。以上是我通常的做法。

更为极致严谨的做法，应当采用1和2中的方法的进一步融合，即完成上述步骤后，再根据磁基态，开启自旋极化和SOC进行结构优化。

我的通常做法进行结构优化的INCAR设置如下：

```shell

SYSTEM = MOPTSNS
LREAL= Auto
ALGO= Fast 
PREC=High

ISTART = 0
ICHARG = 2

ENCUT = 520
NCORE= 4
ISYM=-1

ISMEAR =0
SIGMA = 0.04

NSW = 200
ISIF = 3
IBRION =2
LWAVE=.F
LCHARG=.F
EDIFF = 1E-4
EDIFFG = -0.1


```

由于要逐步优化，所以依次减小能量的收敛标准为1e-6、1e-8，力的收敛标准为-0.1、-0.05、-0.01、-0.001，其中1e-6搭配-0.05和-0.01优化两次。

将脚本放到计算目录下，此时目录中要有vasp基本的输入文件。提交任务的脚本为：

```shell

#!/bin/bash 
#PBS -l nodes=1:ppn=64
#PBS -l walltime=640:01:00 
#PBS -j oe
#PBS -q sugon
#PBS -N geo_slide

cd $PBS_O_WORKDIR

echo job id is $PBS_JOBID | tee  pbslog
echo run nodes is following: | tee -a pbslog
cat $PBS_NODEFILE | tee  -a pbslog

echo begin time is `date` | tee -a  pbslog
id=`echo $PBS_JOBID|awk -F. '{print $1}' `
NP=`cat $PBS_NODEFILE|wc -l`


source /public/software/profile.d/compiler_intel-compiler-2021.3.0.sh 
source  /public/software/profile.d/mpi_intelmpi-2021.3.0.sh 
RUN_1=/public/home/cssong/app/vasp/intel_2021.3.0/5.4.4/vasp_std
RUN_2=/public/home/xpwu/app/vasp/intel_2021.3.0/5.4.4/vasp_ncl
cat $PBS_NODEFILE | uniq -c | awk '{ printf("%s:%s\n", $2, $1); }' >> $PBS_JOBID-$PBS_JOBCOOKIE.hosts



		mpirun  -np $NP  ${RUN_1}>&log



```

