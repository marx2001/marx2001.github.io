---
layout: post
title: "Wannier90 学习笔记"
subtitle: "Experience Sharing"
background: '/img/bg-sci-note.jpg'
categories: sci-note
permalink: /sci-note_posts/20251121-w
---

## <center>心得笔记</center>

### 方法论


wannier90 根据 Marzari 和 Vanderbilt (MV) 的方法¹ 计算最大局域化 Wannier 函数 (MLWF)。对于纠缠能带，则使用 Souza、Marzari 和 Vanderbilt (SMV) 的方法²。我们在此简要介绍这些方法和关键定义，但完整细节可在原始论文及参考文献³ 中找到。

第一性原理代码通常用布洛赫态 ψnk 来求解周期性材料的电子结构。这些扩展态由能带索引 n 和晶体动量 k 表征。另一种表示方式是利用称为 Wannier 函数 (WF) 的空间局域函数。

迄今为止，wannier90 已与基于平面波和赝势（范数守恒和超软赝势）的电子结构代码以及像 FLAPW这样的混合基组技术结合使用。


Wannier90的主要目的是将第一性原理计算中得到的扩展的电子态（布洛赫波函数），转换成一类在空间中高度局域化的函数，即最大局域化Wannier函数。这种局域化的表示方法对于分析化学键、计算电子传输性质等非常有用。



从扩展的波函数变换到局域化的波函数，这个过程存在一个“规范选择”问题，即存在无数种数学上等价但局域化程度不同的变换方式。

Wannier90的解决方法（MV方法）是：通过数学优化，寻找一个最佳的规范选择，使得最终得到的Wannier函数在空间上的“展宽”最小，从而实现“最大局域化”。这个总展宽可以分解为三部分：一部分是固有的、无法通过优化减少的展宽；另外两部分分别与单个函数在不同位置的重叠和不同函数之间的重叠有关，优化过程就是通过调整规范来最小化这两部分。



Wannier90本身不进行初始的电子结构计算，它需要从其他第一性原理软件（如VASP、QE等）获取结果作为输入，主要包括两种信息：

重叠积分：描述不同k点（动量空间中的点）的布洛赫态之间的关系，这是计算Berry相位和展宽的关键。

投影：作为优化的初始猜测。它将布洛赫态投影到用户提供的试局域轨道（通常类似于原子轨道）上，帮助算法找到一个好的起点，加速收敛。



这些输入数据和软件内部优化的矩阵都是小型矩阵，并且与第一性原理计算所使用的具体数值基组（如平面波）无关。因此，Wannier90可以与多种主流的计算软件兼容合作。

之前描述的方法适用于彼此分离的“孤立能带”（如绝缘体中的价带）。但在许多材料（如金属）中，能带是相互重叠或“纠缠”在一起的，无法简单分离出一组特定的能带进行转换。
为了解决这个问题，软件引入了一种称为“解缠”的方法。其核心思想是：

首先，用户需要定义一个较大的能量范围，称为“外窗口”。

然后，软件会在这个窗口内的所有电子态中，通过特定的数学变换，主动“挑选”或“构造”出一组数量固定且能量分布平滑的“最佳”电子态子集。这个变换过程旨在让这些被选出的态在空间中尽可能容易地变得局域化。

为了确保计算的准确性，特别是要精确保留材料在某个关键能量区域（例如费米能级附近）的性质，该方法引入了第二个能量窗口，称为“内窗口”或“冻结窗口”。

冻结窗口：落在这个较小窗口内的原始电子态将原封不动、强制性地被包含在最终选出的“最佳子集”中，不允许被混合或改变。

外窗口：在冻结窗口之外、外窗口之内的其余电子态，则参与上述的优化选择过程，用于填补所需电子态数量的空缺。

总结来说，处理纠缠能带是一个两步走的过程：先通过“解缠”在大的能量窗口内智能地挑选出一个好的电子态子集，同时利用“冻结窗口”来保护关键物理性质；然后，再对这个优化后的子集使用标准方法计算其最大局域化Wannier函数。


### 参数

#### 使用方法

wannier90.x 可以使用 MPI 库进行并行运行，以减少计算时间。

串行执行命令：

wannier90.x [-pp] [种子名]

种子名：如果提供了种子名字符串，程序将从名为 种子名.win的文件中读取其输入。默认值为 wannier。您也可以等价地提供字符串 种子名.win来代替种子名。

-pp：此可选标志指示程序生成所需的重叠积分列表，然后退出。此信息将被写入到文件 种子名.nnkp中。

并行执行命令：

mpirun -np 进程数 wannier90.x [-pp] [种子名]

进程数：替换为您想要使用的处理器数量。

请注意，mpirun命令及其命令行选项在您使用的 MPI 实现中可能有所不同：请阅读您的 MPI 手册或咨询您的计算机管理员。

同时请注意，这要求 wannier90.x 可执行文件已编译为其并行版本（请遵循 wannier90 发行版主目录下 README.install文件中的说明），并且 MPI 库和二进制文件已正确安装并配置在您的计算机上。

seedname.win 文件

wannier90 的输入文件 seedname.win采用灵活的自由格式结构。

关键字的顺序不重要。

字母大小写不敏感（因此 num_bands与 Num_Bands是相同的）。

在 !或 #符号之后的字符将被视为注释。

大多数关键字都有默认值；除非在 seedname.win文件中给出了关键字，否则将使用其默认值。

关键字可以通过以下任何一种方式设置：

```shell

num_wann 4
num_wann = 4
num_wann : 4

```

可以将逻辑关键字设置为 true，可以使用以下任意字符串表示：T, true, .true.。




  <img src="/img/wannier90/bg-w1.png" style="width:100%; margin-bottom:5px;">



seedname.win 文件关键词：系统定义

用于定义系统的 seedname.win文件关键词。参数类型表示为：I​ 代表整数，R​ 代表实数，P​ 代表物理量，L​ 代表逻辑值，S​ 代表文本字符串。

注意：在同一个输入文件中，不能同时定义 atoms_cart和 atoms_frac这两个关键词。


### 任务控制参数




  <img src="/img/wannier90/bg-w2.png" style="width:100%; margin-bottom:5px;">



seedname.win 文件关键字：作业控制

用于定义作业控制的 seedname.win文件关键字。参数类型表示为：I​ 代表整数，R​ 代表实数，P​ 代表物理量，L​ 代表逻辑值，S​ 代表文本字符串。

注意：translate_home_cell仅在 write_xyz为 .true.时相关。

### 解纠缠参数



  <img src="/img/wannier90/bg-w3.png" style="width:100%; margin-bottom:5px;">


seedname.win 文件中控制解纠缠的关键字

关键字参数类型说明如下：

I​ 代表整数

R​ 代表实数

P​ 代表物理量

L​ 代表逻辑值

S​ 代表文本字符串


### 优化参数



  <img src="/img/wannier90/bg-w4.png" style="width:100%; margin-bottom:5px;">





  <img src="/img/wannier90/bg-w5.png" style="width:100%; margin-bottom:5px;">






L (Logical): 逻辑值（是/否）

R (Real): 实数

I (Integer): 整数

I,R,R,R: 表示需要提供一组参数，通常为一个整数（如函数索引）后跟三个实数（如空间坐标）


  <img src="/img/wannier90/bg-w5.png" style="width:100%; margin-bottom:5px;">




### 绘图参数


  <img src="/img/wannier90/bg-w6.png" style="width:100%; margin-bottom:5px;">



  <img src="/img/wannier90/bg-w7.png" style="width:100%; margin-bottom:5px;">




  <img src="/img/wannier90/bg-w8.png" style="width:100%; margin-bottom:5px;">



  <img src="/img/wannier90/bg-w9.png" style="width:100%; margin-bottom:5px;">






  <img src="/img/wannier90/bg-w10.png" style="width:100%; margin-bottom:5px;">




### 输运参数



  <img src="/img/wannier90/bg-w11.png" style="width:100%; margin-bottom:5px;">




  <img src="/img/wannier90/bg-w12.png" style="width:100%; margin-bottom:5px;">




  <img src="/img/wannier90/bg-w13.png" style="width:100%; margin-bottom:5px;">
