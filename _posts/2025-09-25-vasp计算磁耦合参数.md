---
layout: post
title: "vasp计算磁耦合参数大小"
subtitle: "Experience Sharing"
background: '/img/bg-sci-note.jpg'
categories: sci-note
permalink: /sci-note_posts/20250925-J
---

## <center>vasp计算磁耦合参数</center>

为了研究二维材料的拓扑自旋纹理，我们需要计算海森堡模型中的DMI的能量大小。

磁耦合参数，即磁性原子之间相互作用的大小。J>0，磁矩倾向于平行排列，即铁磁（FM）；J<0，磁矩倾向于反平行排列，即反铁磁（AFM）。J的大小决定磁耦合的强弱。J大，相互作用强，居里温度/尼尔温度高。J小，相互作用弱，热涨落容易破坏有序性。

J源于电子的交换效应和电子-电子相互作用，包括直接交换、超交换、超超交换、双交换以及RKKY相互作用。

J决定自旋是FM还是AFM，DMI倾向于让自旋扭转，形成螺旋或者畴壁。


**<span style="font-size: 120%"> 1. 能量法计算J值</span>**

以MPSS为例，其结构如图所示

<div align="center"><img src="/img/vasp计算能带/bg-s1.png" alt="MPSS结构图" style="width:500px; height:auto;"/></div>
<div align="center"><img src="/img/vasp计算能带/bg-s2.png" alt="MPSS结构图" style="width:500px; height:auto;"/></div>

需要准备四个INCAR，四个INCAR的唯一区别就是磁态设置——FM、Neel、Stripy、Zigzag。如下图所示，箭头为磁矩方向：


<div style="text-align:center">
  <img src="/img/vasp计算磁耦合参数/bg-c2.png" alt="Fig1" style="width:600px; height:auto;"/>
</div>



四种INCAR如下方所示


INCAR1：

```shell

#General
PREC = ACCURATE
ISTART= 0
ICHARG= 2
ENCUT = 520
EDIFF = 1E-6
EDIFFG = -0.01
LREAL = Auto
NPAR = 4
NSW= 0
IBRION = -1
NELM=300
ISMEAR = 0
SIGMA = 0.05
LCHARG = .F.
LWAVE = .F.
POTIM = 0.1

#Magnetic properties

ISPIN=2
MAGMOM =  6*0.0 4 4 4 4 4 4 48*0.0

NELMIN = 6
LORBIT = 11
ISYM = 0
#LSORBIT = .True.
LMAXMIX = 4  

LDAU = .TRUE.
LDAUTYPE = 2
LDAUL = 2  2 -1 -1
LDAUU = 0.5 2.0 0.0 0.0
LDAUJ = 0.0 0.0 0.0 0.0
LDAUPRINT = 2

AMIX     = 0.1
BMIX     = 0.0001 
AMIX_MAG = 0.8
BMIX_MAG = 0.0001


```



INCAR2
```shell

#General
PREC = ACCURATE
ISTART= 0
ICHARG= 2
ENCUT = 500
EDIFF = 1E-6
EDIFFG = -0.01
LREAL = Auto
NPAR = 4
NSW= 0
IBRION = -1
ISIF = 2
NELM=300
ISMEAR = 0
SIGMA = 0.05
LCHARG = .F.
LWAVE = .F.
POTIM = 0.1

#Magnetic properties

ISPIN=2
MAGMOM =  6*0.0  4 -4 4 -4 4 -4  48*0.0

NELMIN = 6
LORBIT = 11
ISYM = 0
LMAXMIX = 4  

LDAU = .TRUE.
LDAUTYPE = 2
LDAUL = 2  2 -1 -1
LDAUU = 0.5 2.0 0.0 0.0
LDAUJ = 0.0 0.0 0.0 0.0
LDAUPRINT = 2

AMIX     = 0.1
BMIX     = 0.0001 
AMIX_MAG = 0.8
BMIX_MAG = 0.0001



```

INCAR3

```shell

#General
PREC = ACCURATE
ISTART= 0
ICHARG= 1
ENCUT = 500
EDIFF = 1E-6
EDIFFG = -0.01
LREAL = Auto
NPAR = 4
NSW= 0
IBRION = -1
ISIF = 2
NELM=300
ISMEAR = 0
SIGMA = 0.05
LCHARG = .F.
LWAVE = .F.
POTIM = 0.1

#Magnetic properties

ISPIN=2
MAGMOM =  6*0.0   -4 4 4 -4 4 -4  48*0.0

NELMIN = 6
LORBIT = 11
ISYM = 0
LMAXMIX = 4  

LDAU = .TRUE.
LDAUTYPE = 2
LDAUL = 2  2 -1 -1
LDAUU = 0.5 2.0 0.0 0.0
LDAUJ = 0.0 0.0 0.0 0.0
LDAUPRINT = 2

AMIX     = 0.1
BMIX     = 0.0001 
AMIX_MAG = 0.8
BMIX_MAG = 0.0001


```

INCAR4

```shell

#General
PREC = ACCURATE
ISTART= 0
ICHARG= 1
ENCUT = 500
EDIFF = 1E-6
EDIFFG = -0.01
LREAL = Auto
NPAR = 4
NSW= 0
IBRION = -1
ISIF = 2
NELM=300
ISMEAR = 0
SIGMA = 0.05
LCHARG = .F.
LWAVE = .F.
POTIM = 0.1

#Magnetic properties

ISPIN=2
MAGMOM =  6*0.0  4 -4 -4 -4 4 4  48*0.0

NELMIN = 6
LORBIT = 11
ISYM = 0
LMAXMIX = 4  

LDAU = .TRUE.
LDAUTYPE = 2
LDAUL = 2  2 -1 -1
LDAUU = 0.5 2.0 0.0 0.0
LDAUJ = 0.0 0.0 0.0 0.0
LDAUPRINT = 2

AMIX     = 0.1
BMIX     = 0.0001 
AMIX_MAG = 0.8
BMIX_MAG = 0.0001


```


由于是磁性体系，所以要增加很多设置，虽然部分设置是隐式开启或者关闭的，但根据官网的说法，显式地设置出来，也会起到一定的作用。

注意，个人习惯先用AGLO=Fast,这样计算速度快，可以快速了解大概的情况，同时第一次计算的时候，可以取小K点，同样使得计算速度快。单层材料不加IVDW范德华修正。
个人习惯开启自旋极化后不设置磁矩，让其自行演化，得到最准确的基态。

对于强关联体系，必须加U，具体数值自行测试。

由于要设置四种磁态，所以要进行扩胞，根据三近邻海森堡模型，MPSS的扩胞大小要包含任意磁性原子的第三近邻磁性原子。显而易见，对于MPSS材料体系，需要扩胞3*3*1。

准备好POSCAR、POTCAR、KPOINTS后，提交任务进行计算。任务脚本如下：

```shell

#!/bin/bash 
#PBS -l nodes=1:ppn=64
#PBS -l walltime=640:01:00 
#PBS -j oe
#PBS -q sugon
#PBS -N test

cd $PBS_O_WORKDIR

echo job id is $PBS_JOBID | tee  pbslog
echo run nodes is following: | tee -a pbslog
cat $PBS_NODEFILE | tee  -a pbslog

echo begin time is `date` | tee -a  pbslog
id=`echo $PBS_JOBID|awk -F. '{print $1}' `
NP=`cat $PBS_NODEFILE|wc -l`


source /public/software/profile.d/compiler_intel-compiler-2021.3.0.sh 
source  /public/software/profile.d/mpi_intelmpi-2021.3.0.sh 
RUN_1=/public/home/cssong/app/vasp/intel_2021.3.0/5.4.4/vasp_std
RUN_2=/public/home/cssong/app/vasp/intel_2021.3.0/5.4.4/vasp_ncl
cat $PBS_NODEFILE | uniq -c | awk '{ printf("%s:%s\n", $2, $1); }' >> $PBS_JOBID-$PBS_JOBCOOKIE.hosts

	for k in {1,2,3,4}
	do
	mkdir $k
	cd $k
	cp ../POSCAR .
	cp ../POTCAR .
	cp ../KPOINTS .
	cp ../INCAR$k ./INCAR
	mpirun  -np $NP  ${RUN_1}>&log

	cd ..
	done




rm -rf $PBS_JOBID-$PBS_JOBCOOKIE.hosts


```
计算完成后，键入qvasp -e，得到四个能量，进入这个网址：http://www.yunsuan.info/matrixcomputations/solvelinearsystems.html，解线性方程组，其系数如下所示：

<div style="text-align:center">
  <img src="/img/vasp计算磁耦合参数/bg-c1.png" alt="Fig1" style="width:600px; height:auto;"/>
</div>

**<span style="font-size: 120%"> 2. 四态法计算J值</span>**

计算量非常大，不推荐此种方法。四态法最好使用ncl计算，较为准确。另外，如果算z方向，则是把磁矩设置到z方向上，如果计算y方向，就把磁矩设置到y方向上。

方法原理同四态法计算DMI，因此直接放上4个INCAR文件和提交任务脚本：

INCAR1

```shell


#I_CONSTRAINED_M=1


#General
PREC = ACCURATE
ISTART= 0
ICHARG= 2
ENCUT = 520
EDIFF = 1E-6
EDIFFG = -0.01
LREAL = Auto
NPAR = 4
NSW= 0
IBRION = -1
ISIF = 2
NELM=300
ISMEAR = 0
SIGMA = 0.05
LCHARG = .F.
LWAVE = .F.
POTIM = 0.1
#NEDOS = 2001
#NBANDS = 352

#Magnetic properties

ISPIN=2
MAGMOM = 4 0 0 4 0 0 4 0 0 4 0 0 4 0 0 4 0 0 4 0 0 4 0 0 96*0.0

NELMIN = 6
LORBIT = 11
ISYM = 0
LSORBIT = .True.
LMAXMIX = 4  

LDAU = .TRUE.
LDAUTYPE = 2
LDAUL = 2 -1 -1
LDAUU = 4.3 0.0 0.0
LDAUJ = 0.0 0.0 0.0
LDAUPRINT = 2

AMIX     = 0.1
BMIX     = 0.0001 
AMIX_MAG = 0.8
BMIX_MAG = 0.0001


```
INCAR2

```shell

#General
PREC = ACCURATE
ISTART= 0
ICHARG= 2
ENCUT = 500
EDIFF = 1E-6
EDIFFG = -0.01
LREAL = Auto
NPAR = 4
NSW= 0
IBRION = -1
ISIF = 2
NELM=300
ISMEAR = 0
SIGMA = 0.05
LCHARG = .F.
LWAVE = .F.
POTIM = 0.1

#Magnetic properties

ISPIN=2
MAGMOM =4 0 0 4 0 0 4 0 0 4 0 0 4 0 0 4 0 0 4 0 0 -4 0 0 96*0.0

NELMIN = 6
LORBIT = 11
ISYM = 0
LSORBIT = .True.
LMAXMIX = 4  

LDAU = .TRUE.
LDAUTYPE = 2
LDAUL = 2 -1 -1
LDAUU = 4.3 0.0 0.0
LDAUJ = 0.0 0.0 0.0
LDAUPRINT = 2

AMIX     = 0.1
BMIX     = 0.0001 
AMIX_MAG = 0.8
BMIX_MAG = 0.0001

```

INCAR3

```shell

#General
PREC = ACCURATE
ISTART= 0
ICHARG= 1
ENCUT = 500
EDIFF = 1E-6
EDIFFG = -0.01
LREAL = Auto
NPAR = 4
NSW= 0
IBRION = -1
ISIF = 2
NELM=300
ISMEAR = 0
SIGMA = 0.05
LCHARG = .F.
LWAVE = .F.
POTIM = 0.1

#Magnetic properties

ISPIN=2
MAGMOM =-4 0 0 4 0 0 4 0 0 4 0 0 4 0 0 4 0 0 4 0 0 4 0 0 96*0.0

NELMIN = 6
LORBIT = 11
ISYM = 0
LSORBIT = .True.
LMAXMIX = 4  

LDAU = .TRUE.
LDAUTYPE = 2
LDAUL = 2 -1 -1
LDAUU = 4.3 0.0 0.0
LDAUJ = 0.0 0.0 0.0
LDAUPRINT = 2

AMIX     = 0.1
BMIX     = 0.0001 
AMIX_MAG = 0.8
BMIX_MAG = 0.0001


```

INCAR4

```shell

#General
PREC = ACCURATE
ISTART= 0
ICHARG= 1
ENCUT = 500
EDIFF = 1E-6
EDIFFG = -0.01
LREAL = Auto
NPAR = 4
NSW= 0
IBRION = -1
ISIF = 2
NELM=300
ISMEAR = 0
SIGMA = 0.05
LCHARG = .F.
LWAVE = .F.
POTIM = 0.1

#Magnetic properties

ISPIN=2
MAGMOM = -4 0 0 4 0 0 4 0 0 4 0 0 4 0 0 4 0 0 4 0 0 -4 0 0 96*0.0

NELMIN = 6
LORBIT = 11
ISYM = 0
LSORBIT = .True.
LMAXMIX = 4  

LDAU = .TRUE.
LDAUTYPE = 2
LDAUL = 2 -1 -1
LDAUU = 4.3 0.0 0.0
LDAUJ = 0.0 0.0 0.0
LDAUPRINT = 2

AMIX     = 0.1
BMIX     = 0.0001 
AMIX_MAG = 0.8
BMIX_MAG = 0.0001


```

提交任务脚本为：

```shell

#!/bin/bash 
#PBS -l nodes=1:ppn=64
#PBS -l walltime=640:01:00 
#PBS -j oe
#PBS -q sugon
#PBS -N test

cd $PBS_O_WORKDIR

echo job id is $PBS_JOBID | tee  pbslog
echo run nodes is following: | tee -a pbslog
cat $PBS_NODEFILE | tee  -a pbslog

echo begin time is `date` | tee -a  pbslog
id=`echo $PBS_JOBID|awk -F. '{print $1}' `
NP=`cat $PBS_NODEFILE|wc -l`


source /public/software/profile.d/compiler_intel-compiler-2021.3.0.sh 
source  /public/software/profile.d/mpi_intelmpi-2021.3.0.sh 
RUN_1=/public/home/cssong/app/vasp/intel_2021.3.0/5.4.4/vasp_std
RUN_2=/public/home/cssong/app/vasp/intel_2021.3.0/5.4.4/vasp_ncl
cat $PBS_NODEFILE | uniq -c | awk '{ printf("%s:%s\n", $2, $1); }' >> $PBS_JOBID-$PBS_JOBCOOKIE.hosts

	#mkdir static
	#cd static
	#cp ../POSCAR .
	#cp ../POTCAR .
	#cp ../KPOINTS .
	#cp ../incar.static ./INCAR
	#mpirun  -np $NP  ${RUN_2}>&log
	#cd ..

	for k in {1,2,3,4}
	do
	mkdir $k
	cd $k
	cp ../POSCAR .
	cp ../POTCAR .
	cp ../KPOINTS .
	cp ../INCAR$k ./INCAR
	#cp ../static/CHGCAR .
	mpirun  -np $NP  ${RUN_2}>&log

	cd ..
	done




rm -rf $PBS_JOBID-$PBS_JOBCOOKIE.hosts


```